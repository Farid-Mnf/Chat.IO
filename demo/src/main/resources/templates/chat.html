<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<title>Chat</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
	crossorigin="anonymous">

<style>
	html, body{
		height:100%
	}
	.bg-info {
		min-width: 70px;
		height: 40px;
		padding-top: 10px;
		font-size: 20px
	}
	.disp-block{
		display:block;
		margin:10px;
		padding:10px;
		overflow-wrap: break-word;
  		word-wrap: break-word;
	}
	.left-margin{
		margin-left:50px
	}
	.right-margin{
		margin-right:50px
	}
	.scroll-box{
		overflow-y:scroll;
		min-height:200px;
		max-height:450px;
	}
	.message-area{
		position: absolute;
	    width: 90%;
	    bottom: 10px;
	    left: 5%;
	}
</style>
</head>

<body>
	<div class="container" style="height:90%">

		<h3 class="alert alert-info row" role="alert" style="min-height:5%">
			
			<a 	class="btn btn-outline-dark col" href="#"
				th:href="@{/conversations/}+${user.id}">My Chats</a>
			
			<a	class="btn btn-outline-dark col" href="#" th:href="@{/sign-up}">Sign-Up</a>
			
			<a class="btn btn-outline-dark col" href="#" th:href="@{/showLogin}">Login</a>
			<span class="col-6"></span>
			<span	class="badge bg-secondary col"
					th:text="${user.name}">
				User Name
			</span>
		</h3>

		<div class="alert alert-secondary" role="alert" style="min-height:90%">
			<h2 class="badge bg-info" th:text=${contact.name}>
				Reciever name
			</h2>
			<hr>

			<div class="scroll-box" id="chat-items">
				<div th:each="message : ${messages}">
					<!-- IF -->
					<div 	th:if=${message.user.id==user.id} 
							class="alert alert-info disp-block left-margin"
							th:text="${message.content}">
								User
					</div>
					<!-- ELSE -->
					<div 	th:unless=${message.user.id==user.id} 
							class="alert alert-dark disp-block right-margin"
							th:text="${message.content}">
								Contact
					</div>
				</div>
			</div>
			
			<div class="input-group message-area">
				<input id="input" type="text" class="form-control"
					placeholder="Write a message!" aria-label="Write a message!"
					aria-describedby="button-addon2">
				<button onclick="send()" class="btn btn-outline-secondary" type="button"
					id="button-addon2">Send</button>
			</div>
		</div>

	</div>


	<script
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"
		integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG"
		crossorigin="anonymous"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js"
		integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc"
		crossorigin="anonymous"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
		crossorigin="anonymous"></script>
	<script th:inline="javascript">
		function send(){
			var userId = /*[[${user.id}]]*/ 'User Id';
			var convId = /*[[${convId}]]*/ 'Conversation id';
			
			
			console.log("user id:", userId, " -- convId:", convId);
			var message = document.getElementById("input").value;
			var data = JSON.stringify({"userId":userId,"convId":convId,"content":message});
			console.log(data);
  			var xhttp = new XMLHttpRequest();

			xhttp.onreadystatechange = function() {
			    if (this.readyState == 4 && this.status == 200) {
			       console.log(xhttp.responseText);
			       var chatBox = document.getElementById('chat-items');
			       var classList = 'alert alert-info disp-block left-margin';
			       var div = document.createElement('div');
			       div.innerText = message;
			       div.classList = classList;
			       chatBox.appendChild(div);
		       

			    }
			};
			xhttp.open("POST", "/message", true);
			xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
			xhttp.send(data);
			
			
		}
	</script>
</body>

</html>